<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/7.1.0/fuse.min.js" integrity="sha512-H1bWCnc4dDJwdioqpOCkU76ZxEdvBvOy9R9Dd9EqftlzQg92owjX5IVdiOw00llAyQFUZJNPrzDnWZ/lZtf25A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="icon" href="../assets/images/search.ico" />
    <title>Documentation TileMapEditor</title>
</head>
<body>
  <header>
    <nav>
      <a class="nav-left" href="https://github.com/zerosh0/TileMapEditor" target="_blank">
        <img src="../assets/images/github.svg" alt="GitHub" id="github"/>
        <h1 id="title">TileMapEditor</h1>
      </a>
  <div id="search-container">
    <input id="search" placeholder="Rechercher‚Ä¶" autocomplete="off" />
    <div id="search-results"></div>
  </div>
    </nav>
  </header>
    <button id="mobile-menu-btn" aria-label="Ouvrir le menu" class="mobile-menu-btn">
    &#9776;
    </button>

  <img id="illustration" src="../assets/images/illustration.svg" alt="Illustration" />

  <div class="layout">

<aside class="sidebar-left">
  <nav>
    <ul class="menu">
      <li>
        <a href="../index.html">Accueil</a>
      </li>

      <li>
        <a href="getting-started.html">Prise en main</a>
      </li>

      <li class="has-sub">
        <div class="menu-item">
          <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
          <a href="interface.html">Interface</a>
        </div>
        <ul class="submenu">
          <li><a href="interface.html#viewport">Viewport</a></li>
          <li><a href="interface.html#tilepalette">Tile Palette</a></li>
          <li><a href="interface.html#layers">Layers</a></li>
          <li><a href="interface.html#tools">Outils</a></li>
        </ul>
      </li>

      <li class="has-sub">
        <div class="menu-item">
          <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
          <a href="animations.html#">Animations</a>
        </div>
        <ul class="submenu">
          <li><a href="animations.html#intro">Pr√©sentation</a></li>
          <li><a href="animations.html#animation-editor">√âditeur d'animation</a></li>
          <li><a href="animations.html#timeline">Timeline</a></li>
          <li><a href="animations.html#playmode-integration">Int√©gration au mode Play</a></li>
        </ul>
      </li>

      <li class="has-sub">
        <div class="menu-item">
          <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
          <a href="#" class="active">√âditeur Nodal</a>
        </div>
        <ul class="submenu">
          <li><a href="#overview">Pr√©sentation</a></li>
          <li><a href="#node-types">Types de n≈ìuds</a></li>
          <li><a href="#errors">Erreurs & validation</a></li>
          <li><a href="#custom-nodes">Nodes personnalis√©s</a></li>
        </ul>
      </li>

      <li class="has-sub">
        <div class="menu-item">
          <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
          <a href="settings.html" >Param√®tres</a>
        </div>
        <ul class="submenu">
        <li><a href="settings.html#world-settings">World Settings</a></li>
        <li><a href="settings.html#player-profile">Player Profile</a></li>
        <li><a href="settings.html#advanced">Param√®tres Avanc√©s</a></li>
        </ul>
      </li>

      <li class="has-sub">
        <div class="menu-item">
          <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
          <a href="data-format.html">Stockage & Donn√©es</a>
        </div>
        <ul class="submenu">
          <li><a href="data-format.html#level">Niveau</a></li>
          <li><a href="data-format.html#tilemaps">TileMaps</a></li>
          <li><a href="data-format.html#animations">Animations</a></li>
          <li><a href="data-format.html#nodes">Nodes</a></li>
          <li><a href="data-format.html#parameters">Param√®tres</a></li>
        </ul>
      </li>

        <li>
        <a href="references.html">Biblioth√®que</a>
      </li>

    </ul>
  </nav>
</aside>




<main class="content">
  <div class="inner">
    <article>

      <h1 id="overview">Pr√©sentation g√©n√©rale</h1>
      <p>
        Le <strong>LevelGraph</strong> est un √©diteur nodal int√©gr√© qui permet de d√©finir des logiques personnalis√©es pour chaque collision pr√©sente dans un niveau.
        Lorsqu'une collision est s√©lectionn√©e, cliquez sur l'ic√¥ne <strong>engrenage + cl√© √† molette</strong> (en haut √† droite de la section "Editing") pour ouvrir l'√©diteur nodal associ√©.
      </p>
<picture>
  <source srcset="../assets/image_webp/levelgraph.webp" type="image/webp" />
  <img src="../assets/images/levelgraph.gif" alt="Ouverture du level graph" style="max-width: 100%; margin-bottom: 1rem;" loading="lazy" />
</picture>
      <h2 id="navigation">Navigation et interaction</h2>
      <ul>
        <li><strong>Clique droit</strong> : ouvrir le menu de cr√©ation de n≈ìud √† l'emplacement du curseur</li>
        <li><strong>Scroll</strong> : zoomer/d√©zoomer dans le menu contextuel ou le viewport</li>
        <li><strong>Drag avec molette ou alt+Clique gauche</strong> : d√©placer la vue dans le viewport</li>
        <li><strong>Drag clique gauche</strong> : s√©lectionner une ou plusieurs nodes</li>
        <li><strong>Supr</strong> : supprimer les nodes s√©lectionn√©es</li>
        <li><strong>Ctrl+C / Ctrl+V</strong> : copier-coller (fonctionne entre plusieurs LevelGraphs)</li>
        <li><strong>Drag sur un pin</strong> : connecter √† un autre pin ou ouvrir une recherche de node connect√©e</li>
        <li><strong>FleÃÄche gauche</strong> : ouvrir/fermer le panneau de node √† gauche (cat√©goris√©)</li>
      </ul>

      <h2 id="node-types">Types de n≈ìuds</h2>
      <p>Chaque n≈ìud repr√©sente une instruction. On distingue 4 grands types :</p>
      <ul>
        <li><strong>√âv√©nements</strong> üî¥ (rouge) : <code>OnEnter</code>, <code>OnExit</code>, <code>OnStart</code>, <code>OnTick</code>, <code>OnEnd</code>, <code>OnOverlap</code></li>
        <li><strong>Actions</strong> ‚ö™ : ex√©cution d'une t√¢che (ex : <code>Teleport</code>, <code>Play Animation</code>)</li>
        <li><strong>Setters</strong> üîß : modification de donn√©es (ex : <code>Set Player Speed</code>)</li>
        <li><strong>Getters</strong> üü£ : r√©cup√©ration de donn√©es (ex : <code>Get Player Health</code>)</li>
      </ul>
      <p>
        Les <strong>pins blancs</strong> sont des <em>exec pins</em> pour d√©clencher des suites d'actions.
        Les <strong>pins violets</strong> sont des <em>data pins</em> pour transmettre des valeurs.
      </p>
      <div class="alert alert-info">
  <div class="alert-body">
    <strong>Astuce :</strong> Vous pouvez consulter la documentation d'une node directement depuis la biblioth√®que de nodes.  
    Rendez-vous dans la <strong><a href="references.html" target="_blank" style=" color: #055160;">documentation des nodes</a> </strong>pour plus de d√©tails.
  </div>
</div>

<picture>
  <source srcset="../assets/image_webp/nodes.webp" type="image/webp" />
  <img src="../assets/images/nodes.png" alt="Types de n≈ìuds" style="max-width: 100%; margin-bottom: 1rem;" loading="lazy" />
</picture>


      <h2 id="logic-nodes">üß† N≈ìuds logiques et √©v√©nements</h2>

<p>
  Pour construire des logiques dynamiques, l'√©diteur propose plusieurs n≈ìuds essentiels. Voici un aper√ßu des plus utilis√©s :
</p>

<h3>‚öôÔ∏è N≈ìuds de logique</h3>
<ul>
  <li><strong><code>If</code></strong> ‚Äî compare deux valeurs (<code>A</code> et <code>B</code>) avec un op√©rateur (<code>==</code>, <code>!=</code>, <code>&lt;</code>, etc.) et ex√©cute selon le r√©sultat (sorties <code>true</code> ou <code>false</code>).</li>
  <li><strong><code>For</code></strong> ‚Äî ex√©cute une boucle <code>n</code> fois. Utilisez la sortie <code>loop</code> pour les instructions r√©p√©t√©es n fois, et <code>next</code> pour continuer √† la fin de la boucle, i correspond √† l'indice de cette derni√®re.</li>
  <li><strong><code>Sequence</code></strong> ‚Äî d√©clenche une suite d'instructions dans l'ordre (utile pour encha√Æner plusieurs actions).</li>
  <li><strong><code>FlipFlop</code></strong> ‚Äî alterne entre deux sorties <code>A</code> et <code>B</code> √† chaque activation.</li>
  <li><strong><code>Once</code></strong> ‚Äî n'ex√©cute qu'une seule fois, m√™me si le flux repasse dedans. Tr√®s utile pour d√©clencher des actions uniques.</li>
  <li><strong><code>Set Variable</code></strong> / <strong><code>Get Variable</code></strong> ‚Äî permet de stocker et r√©utiliser des valeurs (√©tats, compteurs, flags...)</li>
</ul>
<picture>
  <source srcset="../assets/image_webp/logic.webp" type="image/webp" />
  <img src="../assets/images/logic.png" alt="N≈ìuds logiques" style="max-width: 100%; margin-top: 1rem;" loading="lazy" />
</picture>


<div class="alert alert-warning">
  <div class="alert-body">
    <strong>Remarque :</strong> Les variables utilis√©es avec <code>Set Variable</code> et <code>Get Variable</code> sont <strong>propres √† chaque LevelGraph</strong>.  
    Elles sont <strong>r√©initialis√©es √† chaque lancement du mode Play</strong>, ce qui signifie qu'elles ne conservent pas leur valeur entre deux sessions.
  </div>
</div>

<h3>üéØ N≈ìuds d'√©v√©nements</h3>
<p>
  Chaque √©v√©nement repr√©sente un d√©clencheur automatique. Un m√™me √©v√©nement ne peut √™tre ajout√© qu'une seule fois par LevelGraph.
</p>
<ul>
  <li><strong><code>OnEnter</code></strong> ‚Äî d√©clench√© lorsque le joueur entre dans la collision</li>
  <li><strong><code>OnExit</code></strong> ‚Äî d√©clench√© √† la sortie du joueur de la collision</li>
  <li><strong><code>OnOverlap</code></strong> ‚Äî d√©clench√© tant que le joueur reste dans la collision</li>
  <li><strong><code>OnStart</code></strong> ‚Äî au lancement du mode Play</li>
  <li><strong><code>OnTick</code></strong> ‚Äî d√©clench√© √† chaque frame (‚ö†Ô∏è √† utiliser avec mod√©ration)</li>
  <li><strong><code>OnEnd</code></strong> ‚Äî √† la fermeture du mode Play</li>
</ul>

<picture>
  <source srcset="../assets/image_webp/events.webp" type="image/webp" />
  <img src="../assets/images/events.png" alt="Types de n≈ìuds d'√©v√©nements" style="max-width: 100%; margin-top: 1rem;" loading="lazy" />
</picture>



<div class="alert alert-info">
  <div class="alert-body">
    <strong>Info :</strong> Lors de la sauvegarde d'un niveau, le graphe nodal est automatiquement enregistr√© dans un fichier <code>.lvg</code>, plac√© dans le m√™me dossier que le fichier <code>.json</code> du niveau.  
    Le chemin absolu de ce fichier est stock√© dans le <code>.json</code> du niveau.  
    Lors du chargement, l'√©diteur tente d'abord d'ouvrir ce fichier via le chemin absolu. Si celui-ci est introuvable (par exemple apr√®s un d√©placement), il essaiera alors de le retrouver en utilisant un chemin relatif bas√© sur le dossier du niveau.
  </div>
</div>

      <h2 id="errors">üí• Gestion des erreurs</h2>
      <p>
        Le syst√®me est dot√© d'un <strong>m√©canisme de d√©tection d'erreur runtime</strong>. Si une erreur est rencontr√©e pendant l'ex√©cution en mode Play :
      </p>
      <ul>
        <li>Le jeu est mis en pause automatiquement</li>
        <li>Le LevelGraph concern√© est rouvert</li>
        <li>Un message d'erreur d√©taill√© est affich√©</li>
      </ul>
<picture>
  <source srcset="../assets/image_webp/error.webp" type="image/webp" />
  <img src="../assets/images/error.png" alt="Error" style="max-width: 100%; margin-bottom: 1rem;" loading="lazy" />
</picture>

      <div class="alert alert-error">
        <div class="alert-body">
          <strong>Attention :</strong> Les erreurs non typ√©es (ex : un setter avec une mauvaise valeur de type) peuvent ne pas √™tre intercept√©es et faire planter l'√©diteur.
        </div>
      </div>

<h3>üßµ Ex√©cution mono-thread</h3>
<p>
  L'ex√©cution du <strong>LevelGraph</strong> se fait enti√®rement dans le <strong>fil principal</strong> du jeu, aussi appel√© thread principal.
  Cela signifie que chaque instruction nodale est trait√©e les unes apr√®s les autres, sans interruption ni ex√©cution en parall√®le.
</p>

<p>
  En pratique, cela veut dire que si une s√©rie de n≈ìuds prend trop de temps √† s'ex√©cuter (par exemple une boucle tr√®s longue), <strong>le jeu peut se figer temporairement</strong>, le temps que toute la cha√Æne soit parcourue. Aucune autre logique ou animation ne pourra s'ex√©cuter durant ce laps de temps.
</p>

<div class="alert alert-info">
  <div class="alert-body">
    <strong>Conseil :</strong> Le n≈ìud <code>Delay</code> est le seul √† fonctionner de mani√®re <strong>asynchrone</strong>. Il permet de suspendre l'ex√©cution sans bloquer le reste du jeu. Vous pouvez l'utiliser pour ins√©rer des pauses dans vos logiques sans impacter la fluidit√© globale.
  </div>
</div>

  <img src="../assets/images/delay.jpg" alt="Delay exception" class="no-bg" style="max-width: 100%; margin-bottom: 1rem; box-shadow: -1px 7px 16px 3px rgb(208 208 219);" loading="lazy" />


<div class="alert alert-warning">
  <div class="alert-body">
    <strong>Attention :</strong> Le n≈ìud <code>Delay</code> <strong>ne peut pas √™tre utilis√©</strong> directement √† la sortie du pin loop d'une boucle For, car les boucles sont ex√©cut√©es de mani√®re synchrone. Cette erreur est automatiquement d√©tect√©e par l'√©diteur et signal√©e.
  </div>
</div>

<p>
  <ul>
    <li>üü¢ Les ex√©cutions sont s√©quentielles : une instruction √† la fois</li>
    <li>üî¥ Aucune ex√©cution parall√®le n'est possible entre deux cha√Ænes de n≈ìuds</li>
    <li>‚è±Ô∏è √âvitez les logiques co√ªteuses ou les boucles trop grandes sans contr√¥le</li>
    <li>üß† Pensez √† isoler des comportements complexes avec des <code>Delay</code> ou des s√©quences bien d√©coup√©es</li>
  </ul>
</p>


      <h3>üîÅ Boucles infinies ?</h3>
      <p>
        En th√©orie, une boucle infinie est impossible : chaque node ne peut avoir qu'un seul pin <code>exec</code> entrant et sortant. Toutefois, soyez attentif √† vos logiques r√©p√©titives.
      </p>

      <h2 id="audio">üîä Syst√®me audio</h2>
      <p>
        Deux n≈ìuds permettent de jouer des sons :
      </p>
      <ul>
        <li><code>Play Sound</code> : joue un son brut</li>
        <li><code>Emit Sound From</code> : joue un son spatialis√© depuis un <code>Location Point</code></li>
      </ul>
<picture>
  <source srcset="../assets/image_webp/sound.webp" type="image/webp" />
  <img src="../assets/images/sound.png" alt="Syst√®me audio" style="max-width: 100%; margin-bottom: 1rem;" loading="lazy" />
</picture>

      <div class="alert alert-info">
        <div class="alert-body">
          <strong>Info :</strong> Les sons doivent √™tre plac√©s dans <code>./Ressources/audio_files</code> pour appara√Ætre dans les s√©lecteurs.
        </div>
      </div>
<div class="alert alert-warning">
  <div class="alert-body">
    <strong>Limite :</strong> Par d√©faut, <code>pygame</code> ne permet que <strong>8 canaux audio simultan√©s</strong>, ce qui signifie que seuls 8 sons peuvent √™tre jou√©s en m√™me temps. 
    L'√©diteur √©l√®ve automatiquement cette limite √† <strong>32 canaux:</strong>
    <br><br>
    <code>pygame.mixer.set_num_channels(32)</code>
    <br><br>
    Cette ligne se trouve en bas du fichier <code>main.py</code>, dans le bloc <code>if __name__ == "__main__"</code>.
    <br><br>
    ‚ûï Si vous jouez beaucoup de sons (par exemple via des effets, musiques et sons spatialis√©s), certains peuvent √™tre ignor√©s. Dans ce cas, vous pouvez augmenter la limite, par exemple :
    <pre><code>pygame.mixer.set_num_channels(64)</code></pre>
    
    ‚úÖ Si cette limite est atteinte en cours d'ex√©cution, <strong>l'√©diteur vous affichera automatiquement un message d'avertissement</strong> pour vous en informer, afin que vous puissiez ajuster cette valeur.
    <br><br>
    ‚ö†Ô∏è Attention toutefois : augmenter le nombre de canaux augmente l√©g√®rement l'utilisation m√©moire et peut entra√Æner des probl√®mes de mixage ou de saturation audio sur certaines machines.
  </div>
</div>

<h2 id="conditions">üß© Conditions de placement</h2>
<p>
  Tous les n≈ìuds ne sont pas disponibles imm√©diatement : certains d√©pendent du contexte du niveau ou de la pr√©sence de certaines ressources. Ces restrictions √©vitent des erreurs lors de l'ex√©cution.
</p>

<picture>
  <source srcset="../assets/image_webp/teleport_error.webp" type="image/webp" />
  <img src="../assets/images/teleport_error.png" alt="Exemple de nodes d√©sactiv√©s" style="max-width: 100%; margin-top: 1rem;" loading="lazy" />
</picture>


<p style="font-style: italic; font-size: 0.9rem; margin-top: 0.5rem;">
  Exemple : certains n≈ìuds comme <code>Teleport</code> sont d√©sactiv√©s tant qu'aucun point de localisation n'est plac√© sur la sc√®ne.
</p>
<div class="alert alert-warning">
  <div class="alert-body">
    <strong>Remarque :</strong> Si un n≈ìud ne peut pas √™tre pos√©, il sera d√©sactiv√©. L'√©diteur emp√™che alors automatiquement son ajout pour garantir la coh√©rence du graphe.
  </div>
</div>

<h3>üîÑ Exemples fr√©quents</h3>
<ul>
  <li><strong>üîÄ Teleport</strong> : n√©cessite au moins un <code>Location Point</code> plac√© dans le niveau.</li>
  <li><strong>üéµ N≈ìuds Audio</strong> : pour utiliser <code>Play Sound</code>, <code>Emit Sound From</code>, etc., il faut que des fichiers audio soient pr√©sents dans <code>./Ressources/audio_files</code>.</li>
  <li><strong>üîÅ Emit Sound From</strong> : d√©pend de la pr√©sence d'un <code>Location Point</code> dans la sc√®ne.</li>
</ul>

<h3>üìÅ Emplacements des ressources</h3>
<p>
  Pour que les <strong>n≈ìuds audio</strong> puissent jouer des sons dans un niveau, les fichiers doivent √™tre plac√©s dans des dossiers sp√©cifiques. L'√©diteur les parcourt automatiquement pour alimenter le menu de s√©lection.
</p>

<ul>
  <li>
    <code>./Ressources/audio_files</code> ‚Äî r√©pertoire principal pour <strong>vos sons personnalis√©s</strong>. Tous les fichiers audio ajout√©s ici seront disponibles dans l'√©diteur.
  </li>
  <li>
    <code>./editor/game_engine/Assets/sounds_effects</code> ‚Äî utilis√© exclusivement par les <strong>niveaux d'exemple</strong> fournis avec l'√©diteur (par exemple <code>new_exemple.json</code>). Il permet de s√©parer les ressources internes de d√©monstration des projets utilisateurs.
  </li>
</ul>

<div class="alert alert-info">
  <div class="alert-body">
    <strong>Conseil :</strong> Pour garder vos projets propres et autonomes, placez vos fichiers sonores dans <code>./Ressources/audio_files</code>. √âvitez de modifier les ressources syst√®me ou d'exemple.
  </div>
</div>

  <h2 id="custom-nodes">üß© Cr√©er ses propres Custom Nodes</h2>

  <p>
    Le syst√®me nodal est extensible gr√¢ce aux <strong>Custom Nodes</strong>, que vous pouvez ajouter simplement en Python.
    Chaque n≈ìud personnalis√© h√©rite de la classe <code>Node</code> et est enregistr√© via le d√©corateur <code>@register_node</code>.
  </p>

<div class="alert alert-warning">
  <div class="alert-body">
    <strong>Important :</strong> Tous les n≈ìuds personnalis√©s doivent √™tre d√©finis dans le fichier
    <code>./editor/blueprint_editor/blueprints/b_custom.py</code> pour √™tre reconnus par l‚Äô√©diteur.
    Assurez-vous que vos classes soient bien d√©cor√©es avec <code>@register_node</code>.
  </div>
</div>


  <h3>üîß Structure de base</h3>
  <pre class="language-python"><code>
@register_node("NomAffich√©", category="MaCat√©gorie")
class MonNode(Node):
    def __init__(self, pos, editor, properties):
        super().__init__(pos, "TitreDuNode", editor, properties)
        # Ajouter des pins ici
        self.add_data_pin("nom", is_output=False, default=0, label="Entr√©e")
    
    def execute(self, context):
        # Code d'ex√©cution ici
        next_node = next((p.connection.node for p in self.outputs if p.pin_type == "exec"), None)
        return next_node # ou None si c'est un getter car pas de pin exec √† suivre
  </code></pre>

  <p>
    Chaque n≈ìud h√©rite de <code>Node</code> et doit red√©finir la m√©thode <code>execute(self, context)</code>.<br>
    Les sorties (appel√©es <strong>pins</strong>) peuvent √™tre ajout√©es avec <code>add_data_pin</code>.
  </p>

  <h3>üì§ Exemple 1 : Getter</h3>
  <p>Expose une valeur du jeu via un pin de sortie.</p>
  <pre class="language-python"><code>
@register_node("Get Score", category="Custom")
class GetScore(Node):
    def __init__(self, pos, editor, properties):
        super().__init__(pos, "Get Score", editor, properties)
        self.inputs.clear()  # Pas d'entr√©e
        self.outputs.clear()
        self.add_data_pin("score", is_output=True, default=0, label="Score")
    
    def execute(self, context):
        self.properties["score"] = self.editor.game_state.get("player_score", 0)
        return None
  </code></pre>

  <h3>üì• Exemple 2 : Setter</h3>
  <p>Re√ßoit une valeur via un pin d'entr√©e et l'enregistre.</p>
  <pre class="language-python"><code>
@register_node("Set Health", category="Custom")
class SetHealth(Node):
    def __init__(self, pos, editor, properties):
        super().__init__(pos, "Set Health", editor, properties)
        self.add_data_pin("hp", is_output=False, default=100, label="HP")
    
    def execute(self, context):
        pin = next(p for p in self.inputs if p.name == "hp")
        value = pin.connection.node.properties[pin.connection.name] if pin.connection else self.properties["hp"]
        self.editor.game_state["player_health"] = int(value)
        return next((p.connection.node for p in self.outputs if p.pin_type == "exec"), None)
  </code></pre>

  <h3>‚ñ∂Ô∏è Exemple 3 : Action</h3>
  <p>D√©clenche une animation ou effet sans manipulation de donn√©es.</p>
  <pre class="language-python"><code>
@register_node("Play Animation", category="Custom")
class PlayAnim(Node):
    def __init__(self, pos, editor, properties):
        super().__init__(pos, "Play Animation", editor, properties)
        self.add_data_pin("anim_name", is_output=False, default="idle", label="Animation")
    
    def execute(self, context):
        pin = next(p for p in self.inputs if p.name == "anim_name")
        name = pin.connection.node.properties[pin.connection.name] if pin.connection else self.properties["anim_name"]
        self.editor.game_engine.play_animation(name)
        return next((p.connection.node for p in self.outputs if p.pin_type == "exec"), None)
  </code></pre>

<h3>üé¨ Exemple 4 : Action avec UI - <code>Play Animation</code></h3>
<p>
  Ce n≈ìud permet de jouer une animation pr√©d√©finie dans l'√©diteur. L'utilisateur peut s√©lectionner l'animation via une liste d√©roulante dynamique.
</p>

<div class="alert alert-info">
  <div class="alert-body">
    <strong>Type :</strong> Action - ce n≈ìud d√©clenche un effet mais ne transf√®re pas de donn√©es.  
  </div>
</div>

<h4>üí° Comportement</h4>
<ul>
  <li>Affiche dynamiquement les animations disponibles √† partir du gestionnaire de l'√©diteur.</li>
  <li>Joue l'animation s√©lectionn√©e lorsque le n≈ìud est ex√©cut√©.</li>
  <li>Utilise un <code>DropdownButton</code> pour l'UI.</li>
</ul>

<h4>üß± Code complet (./editor/blueprint_editor/blueprints/b_animations.py)</h4>

<pre class="language-python"><code>
@register_node("Play Animation", category="Animation")
class PlayAnimation(Node):
    def __init__(self, pos, editor, properties):
        super().__init__(pos, 'Play Animation', editor, properties)
        self.editor = editor

        # DropdownButton avec les noms des animations
        self.btn = DropdownButton(
            self,
            pygame.Rect(10, 30, 120, 24),
            list(self.editor.LevelEditor.animations.animations.keys()),
            callback=self._on_select
        )

        # R√©utilisation d'un choix pr√©c√©dent
        if self.properties.get('choice'):
            self.btn.selected = self.properties['choice']

        # Ajout √† l'UI
        self.ui_elements.append(self.btn)

    def _on_select(self, opt: str):
        self.properties['choice'] = opt

    def updateDropDownField(self):
        # Met √† jour les options depuis le dictionnaire d'animations
        self.btn.options = list(self.editor.LevelEditor.animations.animations.keys())
        if not self.btn.selected in self.btn.options and self.btn.options:
            self.btn.selected = self.btn.options[0]

    def draw(self, surf, selected=False):
        self.updateDropDownField()
        super().draw(surf, selected)
        for el in self.ui_elements:
            el.update_position(self.x, self.y)
            el.draw(surf)

    def execute(self, context):
        # Met √† jour les entr√©es data si pr√©sentes
        for pin in self.inputs:
            if pin.pin_type == 'data' and pin.connection:
                src = pin.connection
                getter_node = src.node
                getter_node.execute(context)
                self.properties[pin.name] = getter_node.properties[src.name]

        # Joue l'animation s√©lectionn√©e
        anim = self.editor.LevelEditor.animations.animations[self.btn.selected]
        anim.timeline.current = 0.0
        anim.play(anim.timeline.loop)

        # Passe au prochain n≈ìud de la branche
        out = next((p for p in self.outputs if p.pin_type == 'exec'), None)
        return out.connection.node if out and out.connection else None
</code></pre>

<h4>üñºÔ∏è Interface dans l'√©diteur</h4>
<p>Le n≈ìud s'affichera avec un bouton d√©roulant contenant les noms des animations disponibles.</p>
<ul>
  <li>Les options sont automatiquement extraites du gestionnaire <code>self.editor.LevelEditor.animations</code>.</li>
  <li>Le champ <code>choice</code> dans les <code>properties</code> stocke le nom choisi.</li>
</ul>


  <h2 id="next-steps">Envie d'en savoir plus ?</h2>
  <p>
    Consultez les pages suivantes pour explorer les fonctionnalit√©s cl√©s de l'√©diteur :
  </p>
  <ul>
    <li>
      üîß <strong><a href="interface.html">Interface</a></strong> ‚Äî Comprendre les outils de dessin, la gestion des layers et le fonctionnement du viewport.
    </li>
    <li>
      üéûÔ∏è <strong><a href="animations.html">Animations</a></strong> ‚Äî Cr√©ez, √©ditez et d√©clenchez des animations dans vos niveaux √† l'aide de la timeline visuelle.
    </li>
<picture>
  <source srcset="../assets/image_webp/sleep.webp" type="image/webp" />
  <img src="../assets/images/sleep.gif" alt="√âditeur Nodal en action" style="max-width: 600px; margin-top: 1em;" loading="lazy" />
</picture>


    </article>
  </div>
</main>

<aside class="sidebar-right" style="height: 220px;">
  <div class="toc">
    <strong>Sur cette page</strong>
    <ul>
      <li><a href="#overview">Pr√©sentation g√©n√©rale</a></li>
      <li><a href="#navigation">Navigation</a></li>
      <li><a href="#node-types">Types de n≈ìuds</a></li>
      <li><a href="#logic-nodes">N≈ìuds logiques</a></li>
      <li><a href="#errors">Gestion des erreurs</a></li>
      <li><a href="#audio">Syst√®me audio</a></li>
      <li><a href="#conditions">Conditions</a></li>
      <li><a href="#custom-nodes">Noeuds personnalis√©s</a></li>
    </ul>
  </div>
</aside>






  </div>

</body>
    <script src="../assets/js/script.js"></script>
    <footer>
  <img src="https://damp-credit-b584.0zeroshell.workers.dev/?access_key=MHBQ4R2E3W99O0lqs4zox1uzmbA76EB2Bddm8WB82nIsKAEpb0"alt="">
</footer>
</html>
